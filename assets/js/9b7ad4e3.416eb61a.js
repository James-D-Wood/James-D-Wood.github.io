"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7979],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),p=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(a),u=n,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||o;return a?r.createElement(h,s(s({ref:t},c),{},{components:a})):r.createElement(h,s({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,s=new Array(o);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:n,s[1]=i;for(var p=2;p<o;p++)s[p]=a[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},6915:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var r=a(7462),n=(a(7294),a(3905));const o={},s="Deep Research: Secure vsftpd Configuration",i={unversionedId:"home-lab/services/notes/deep-research-vsftpd",id:"home-lab/services/notes/deep-research-vsftpd",title:"Deep Research: Secure vsftpd Configuration",description:"The following was generated by OpenAI's Deep Research tool. I am keeping it here as a reference as one of the resources used when learning FTP server setup best practices.",source:"@site/docs/home-lab/services/notes/deep-research-vsftpd.md",sourceDirName:"home-lab/services/notes",slug:"/home-lab/services/notes/deep-research-vsftpd",permalink:"/docs/home-lab/services/notes/deep-research-vsftpd",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Notes",permalink:"/docs/category/notes"},next:{title:"NVR",permalink:"/docs/home-lab/services/nvr"}},l={},p=[{value:"Anonymous vs. Local User FTP Access",id:"anonymous-vs-local-user-ftp-access",level:2},{value:"Chroot Jailing Local Users (Isolation and Implications)",id:"chroot-jailing-local-users-isolation-and-implications",level:2},{value:"Securing vsftpd for IP Camera Recordings",id:"securing-vsftpd-for-ip-camera-recordings",level:2},{value:"Performance and System Reliability Considerations",id:"performance-and-system-reliability-considerations",level:2},{value:"Recommended Configuration &amp; Mitigation Summary",id:"recommended-configuration--mitigation-summary",level:2}],c={toc:p};function d(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"deep-research-secure-vsftpd-configuration"},"Deep Research: Secure vsftpd Configuration"),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"The following was generated by OpenAI's Deep Research tool. I am keeping it here as a reference as one of the resources used when learning FTP server setup best practices. ")),(0,n.kt)("p",null,"When setting up ",(0,n.kt)("strong",{parentName:"p"},"vsftpd")," on Ubuntu to store footage from an IP camera, it's important to balance security with functionality. Below is a summary of key findings and best practices drawn from official documentation, security reports, and community forums. These address user access methods, chroot jails, general hardening for IP camera uploads, and performance considerations."),(0,n.kt)("h2",{id:"anonymous-vs-local-user-ftp-access"},"Anonymous vs. Local User FTP Access"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Use of Anonymous FTP:")," Allowing anonymous logins means the camera (or anyone) can connect without a password. This is generally ",(0,n.kt)("strong",{parentName:"p"},"not recommended for sensitive data")," like security video recordings. Anonymous FTP is intended for public file sharing, not private storage. By default, vsftpd permits anonymous login (if not explicitly disabled) (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=anonymous_enable%20Controls%20whether%20anonymous%20logins,are%20recognised%20as%20anonymous%20logins"},"Manpage of VSFTPD.CONF"),"), so you should explicitly turn it off unless absolutely necessary. MyIPCameraBrand cameras do support anonymous FTP if no username/password is provided, but enabling that would essentially open your FTP server to anyone on the network (or internet) if not firewalled."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Security Risks:")," An ",(0,n.kt)("strong",{parentName:"p"},"anonymous FTP server")," can be accessed by anyone, increasing risk of unauthorized viewing, tampering, or uploading of files. Even if write permissions for anonymous users are restricted, an open FTP could allow malicious actors to fill your disk or exploit the server. The vsftpd docs note that giving anonymous users broad write access (upload, delete, etc.) is ",(0,n.kt)("em",{parentName:"p"},"\u201cgenerally not recommended\u201d")," (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=anon_other_write_enable%20If%20set%20to%20YES%2C,recommended%20but%20included%20for%20completeness"},"Manpage of VSFTPD.CONF"),").")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Local (Authenticated) Users:")," Using named user accounts with passwords is ",(0,n.kt)("strong",{parentName:"p"},"far more secure"),". vsftpd should be configured with ",(0,n.kt)("inlineCode",{parentName:"p"},"anonymous_enable=NO")," (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=vi%20%2Fetc%2Fvsftpd%2Fvsftpd"},"Secure FTP Server - vsftpd - Documentation"),") to require authentication. The MyIPCameraBrand camera supports entering a username and password for FTP, so you can create a dedicated FTP user on the Ubuntu server for the camera. This ensures only those with the credentials can access the FTP service. Community guides strongly advocate disabling anonymous login so that only trusted users access the server (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Disable%20Anonymous%20Login%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),").")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Local User vs. Virtual User:")," vsftpd offers two types of authenticated accounts \u2013 ",(0,n.kt)("strong",{parentName:"p"},"system local users")," (normal Linux accounts) or ",(0,n.kt)("strong",{parentName:"p"},"virtual users")," defined only in vsftpd\u2019s own config. Virtual users (with PAM backend) have no real shell or system access, which ",(0,n.kt)("em",{parentName:"p"},"\u201censures that if a virtual user gets compromised, ","[the attacker]"," will have no other permissions except FTP\u201d")," (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=,a%20bit%20of%20extra%20work"},"Secure FTP Server - vsftpd - Documentation"),"). This is very secure, as it confines any breach to FTP alone. However, setting up virtual users is more complex. For most cases, a dedicated local Linux user (with a locked shell) for the camera is sufficient, provided it\u2019s limited properly.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Best Practice:")," ",(0,n.kt)("strong",{parentName:"p"},"Use a local user account per camera")," (or one account for all cameras, with a strong password) instead of anonymous access. Ensure ",(0,n.kt)("inlineCode",{parentName:"p"},"local_enable=YES")," in ",(0,n.kt)("strong",{parentName:"p"},"vsftpd.conf")," (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=anonymous_enable%3DNO"},"Secure FTP Server - vsftpd - Documentation"),") (this is usually the default on Ubuntu) so local users can log in. Give the FTP user a non-login shell (e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},"/usr/sbin/nologin"),") to prevent shell access. This approach provides accountability (each login is authenticated) and the ability to apply file permissions. In contrast, anonymous access should only be used on isolated networks with read-only purposes (and even then, with caution). One forum user bluntly states: ",(0,n.kt)("em",{parentName:"p"},"\u201cThe FTP server should not be accessible outside the LAN \u2013 it's for internal traffic only\u201d")," (",(0,n.kt)("a",{parentName:"p",href:"https://www.reddit.com/r/linux4noobs/comments/ukq1eu/i_need_an_ftp_server_for_cctv_i_tried_and_failed/#:~:text=The%20FTP%20server%20should%20not,the%20camera%20takes%20the%20processing"},"I need an FTP server for CCTV, i tried and failed, so reaching out... : r/linux4noobs"),"), underlining that if you ever ",(0,n.kt)("em",{parentName:"p"},"do")," allow anonymous or weakly secured FTP, it must be in a very controlled network segment."))),(0,n.kt)("h2",{id:"chroot-jailing-local-users-isolation-and-implications"},"Chroot Jailing Local Users (Isolation and Implications)"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Chrooting")," an FTP user means restricting that user to a specific directory tree (typically their home directory) so they cannot see or affect the rest of the system. vsftpd supports this via the ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_local_user")," setting. Enabling ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_local_user=YES")," will jail ",(0,n.kt)("strong",{parentName:"p"},"all local FTP users")," in their home directories by default (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=chroot_local_user%3DYES"},"Very Secure FTP Daemon - ArchWiki"),"). This is highly recommended for an IP camera FTP user, so the camera (and anyone who might compromise its credentials) cannot navigate outside its upload folder."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Security Benefits:")," A chroot jail greatly limits the scope of what a user can do. The FTP user will see their home directory as the root (",(0,n.kt)("inlineCode",{parentName:"p"},"/"),") of the FTP session and cannot traverse above it (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=A%20chroot%20environment%20that%20prevents,etc%2Fvsftpd.conf"},"Very Secure FTP Daemon - ArchWiki"),"). This containment means even if someone guesses or steals the camera's FTP credentials, they cannot access system files or other directories \u2013 they are locked to a specific folder (e.g., ",(0,n.kt)("inlineCode",{parentName:"p"},"/home/ftp-cam/")," or whatever you choose as the FTP storage directory). This is a standard best practice: ",(0,n.kt)("em",{parentName:"p"},"\u201cRestricting users to their home directories limits their access within the server, minimizing the risk of unauthorized file access or manipulation.\u201d")," (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Limit%20User%20Access%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),").")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Functional Impact:")," When chroot is in effect, features that rely on access to other parts of the filesystem are off-limits. In practice, an IP camera uploading files doesn't need access outside its folder, so functionality is not hampered. However, you must ensure the directory structure and permissions are set such that the camera can actually write files in its jail (see next point on configuration). Also note, if you have multiple cameras each with their own login, each can be isolated to a different home directory using chroot (so one camera cannot see another's recordings).")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"vsftpd Warnings and Writeability Issue:")," The vsftpd documentation flags a warning for ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_local_user")," because of a subtle security implication (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=chroot_local_user%20If%20set%20to%20YES%2C,jails"},"Manpage of VSFTPD.CONF"),"). If an untrusted user can upload files ",(0,n.kt)("em",{parentName:"p"},"and"),' is chrooted, they technically control what appears to be the root of the filesystem (within their jail). There is a known (though complex) attack called the "',(0,n.kt)("strong",{parentName:"p"},"Roaring Beast"),'" attack where an attacker who can write to their chroot could create fake system files (like ',(0,n.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," or malicious libraries) within the jail and trick the service into using them (",(0,n.kt)("a",{parentName:"p",href:"https://serverfault.com/questions/743949/vsftp-why-is-allow-writeable-chroot-yes-a-bad-idea#:~:text=If%20the%20FTP%20credentials%20of,This%20escalates%20the%20attack"},"security - vsftp: why is allow_writeable_chroot=YES a bad idea? - Server Fault"),") (",(0,n.kt)("a",{parentName:"p",href:"https://serverfault.com/questions/743949/vsftp-why-is-allow-writeable-chroot-yes-a-bad-idea#:~:text=locations,to%20rooting%20the%20entire%20machine"},"security - vsftp: why is allow_writeable_chroot=YES a bad idea? - Server Fault"),"). In vsftpd 2.3.5 and above, the daemon defends against this by refusing to chroot a user into a directory that is ",(0,n.kt)("strong",{parentName:"p"},"owned by that user and writable")," (because then the user could alter e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc")," inside the jail) (",(0,n.kt)("a",{parentName:"p",href:"https://serverfault.com/questions/743949/vsftp-why-is-allow-writeable-chroot-yes-a-bad-idea#:~:text=Having%20a%20non,directories"},"security - vsftp: why is allow_writeable_chroot=YES a bad idea? - Server Fault"),"). If you configure ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_local_user=YES")," without further changes, vsftpd will ",(0,n.kt)("em",{parentName:"p"},"reject logins for any user whose home directory is writable by them"),", giving an error like \u201c500 OOPS: vsftpd: refusing to run with writable root inside chroot().\u201d"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Mitigation 1 \u2013 Non-writable Home:")," The secure solution is to make the FTP home directory owned by root and not writable by the FTP user. Then create a subdirectory where the user ",(0,n.kt)("em",{parentName:"p"},"can")," upload files. For example, if the camera's FTP user is ",(0,n.kt)("inlineCode",{parentName:"p"},"camftp")," with home ",(0,n.kt)("inlineCode",{parentName:"p"},"/srv/ftp/camftp"),", set ",(0,n.kt)("inlineCode",{parentName:"p"},"/srv/ftp/camftp")," owned by root (permissions 755), and create ",(0,n.kt)("inlineCode",{parentName:"p"},"/srv/ftp/camftp/uploads")," owned by ",(0,n.kt)("inlineCode",{parentName:"p"},"camftp")," (permissions 755 or 750). The camera would then be configured to upload into ",(0,n.kt)("inlineCode",{parentName:"p"},"/uploads")," (or simply into the default home, but since the home isn\u2019t writable, you must give them a writable subfolder). This way, the ",(0,n.kt)("em",{parentName:"p"},"root of the chroot jail is not writable by the user"),", and vsftpd will allow the login. The user can write to the subdirectory but cannot create or modify top-level system directories in the jail (like ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc")," within the jail) because they lack permission.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Mitigation 2 \u2013 ",(0,n.kt)("inlineCode",{parentName:"strong"},"allow_writeable_chroot"),":")," If restructuring directories is difficult, vsftpd provides an option to override this restriction. Setting ",(0,n.kt)("inlineCode",{parentName:"p"},"allow_writeable_chroot=YES")," will let users log in even if their home directory is writable (",(0,n.kt)("a",{parentName:"p",href:"https://www.linuxquestions.org/questions/linux-security-4/vsftpd-and-chroot-4175431314/#:~:text=If%20you%20don%27t%20want%20to,conf%20the%20following"}," Vsftpd and chroot."),") (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=allow_writeable_chroot%3DYES%20hide_ids%3DYES"},"Secure FTP Server - vsftpd - Documentation"),"). This is easier (you can let the user's home be owned by them as usual), but it ",(0,n.kt)("strong",{parentName:"p"},"comes with a security warning"),". By enabling this, you re-introduce the risk of the Roaring Beast attack (",(0,n.kt)("a",{parentName:"p",href:"https://serverfault.com/questions/743949/vsftp-why-is-allow-writeable-chroot-yes-a-bad-idea#:~:text=If%20the%20FTP%20credentials%20of,This%20escalates%20the%20attack"},"security - vsftp: why is allow_writeable_chroot=YES a bad idea? - Server Fault"),") \u2013 an attacker who gains the ability to upload could potentially plant malicious files under ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc")," in the jail and trick the FTP service into reading them, leading to privilege escalation. In summary: ",(0,n.kt)("em",{parentName:"p"},"\u201cAllow chroot()'ing to a directory writable by that user... setting this to YES is potentially dangerous\u201d")," (",(0,n.kt)("a",{parentName:"p",href:"https://man.linuxreviews.org/man5/vsftpd.conf.5.html#:~:text=Manpage%20of%20VSFTPD.CONF%20,user%20creates%20an%20%27etc"},"Manpage of VSFTPD.CONF - Linux Manual Database"),"). If you use this option, be aware of the risk. In a scenario like a home camera where the user has ",(0,n.kt)("strong",{parentName:"p"},"no shell access and limited capabilities"),", the risk is arguably low \u2013 but it is not zero. The ",(0,n.kt)("strong",{parentName:"p"},"most secure approach")," remains to keep the chroot directory itself non-writable (",(0,n.kt)("a",{parentName:"p",href:"https://serverfault.com/questions/743949/vsftp-why-is-allow-writeable-chroot-yes-a-bad-idea#:~:text=Having%20a%20non,directories"},"security - vsftp: why is allow_writeable_chroot=YES a bad idea? - Server Fault"),").")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Only Jail the Camera User:")," vsftpd allows flexibility in who is chrooted. If ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_local_user=YES")," is set, ",(0,n.kt)("em",{parentName:"p"},"all")," local users are jailed except any listed in an ",(0,n.kt)("strong",{parentName:"p"},"exception file")," (configured via ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_list_enable")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_list_file"),") (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=chroot_list_enable%3DYES%20chroot_list_file%3D%2Fetc%2Fvsftpd"},"Very Secure FTP Daemon - ArchWiki"),") (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=This%20will%20make%20local%20users,not%20in%20a%20chroot%20jail"},"Very Secure FTP Daemon - ArchWiki"),"). If this is a dedicated server for camera footage, it's fine to jail all users. But if the server has other user accounts (e.g., your personal login) that you don\u2019t want chrooted, you can add those to the exception list in ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/vsftpd.chroot_list")," so only the camera user is jailed. In most cases, though, it's simplest to make the FTP camera user the only user account that actually uses FTP, and chroot them by default.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Conclusion:")," ",(0,n.kt)("strong",{parentName:"p"},"Enable chroot for local FTP users")," to contain the camera\u2019s access. Implement it securely by adjusting directory ownership or using the ",(0,n.kt)("inlineCode",{parentName:"p"},"allow_writeable_chroot")," flag with caution. The consensus is that chroot jails significantly improve security for FTP services (the LinuxQuestions forum notes chroot is \u201cquite secure as long as the user does not have shell access\u201d (",(0,n.kt)("a",{parentName:"p",href:"https://www.linuxquestions.org/questions/linux-security-4/vsftpd-and-chroot-4175431314/#:~:text=I%20would%20say%20chroot,like%20ftps%20or%20sftp%2Fscp"}," Vsftpd and chroot."),")). The small residual risk from an upload-capable user in a chroot jail can be mitigated as described. Overall, the benefit of isolation far outweighs the inconvenience, especially when dealing with an IoT device like an IP camera."))),(0,n.kt)("h2",{id:"securing-vsftpd-for-ip-camera-recordings"},"Securing vsftpd for IP Camera Recordings"),(0,n.kt)("p",null,"Beyond user authentication and chrooting, there are several ",(0,n.kt)("strong",{parentName:"p"},"best practices to harden vsftpd")," when it's used for IP camera uploads:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Enable FTPS (SSL/TLS Encryption):")," FTP by itself is unencrypted \u2013 credentials and footage would travel in cleartext over the network. To protect against eavesdropping (especially if any part of your network is untrusted or if you access the FTP over the internet), enable SSL/TLS in vsftpd. Set ",(0,n.kt)("inlineCode",{parentName:"p"},"ssl_enable=YES")," in ",(0,n.kt)("strong",{parentName:"p"},"vsftpd.conf")," to turn on FTPS support (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Enforce%20FTPS%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),"). You will need to provide a certificate (",(0,n.kt)("inlineCode",{parentName:"p"},"rsa_cert_file")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"rsa_private_key_file")," in the config) or generate a self-signed certificate for the server (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=Start%20by%20adding%20these%20lines,the%20bottom%20of%20the%20file"},"Secure FTP Server - vsftpd - Documentation"),"). On the MyIPCameraBrand camera, enable the ",(0,n.kt)("strong",{parentName:"p"},"\u201cFTPS Only\u201d")," option which forces it to use FTPS for uploads. According to MyIPCameraBrand, all their devices that support FTP can also do explicit FTPS (FTP over TLS). Using FTPS means the username, password, and data are encrypted in transit. This is a significant security improvement since an IP camera is often on Wi-Fi \u2013 you don't want someone sniffing your Wi-Fi traffic and capturing your FTP credentials or video files. ",(0,n.kt)("em",{parentName:"p"},"Note:")," MyIPCameraBrand cameras use ",(0,n.kt)("strong",{parentName:"p"},"explicit FTPS on port 21")," (not implicit FTPS on 990). Ensure vsftpd is configured for explicit TLS (which it is by default when ",(0,n.kt)("inlineCode",{parentName:"p"},"ssl_enable=YES")," on port 21). You might also want to enforce FTPS for all logins by adding ",(0,n.kt)("inlineCode",{parentName:"p"},"force_local_logins_ssl=YES")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"force_local_data_ssl=YES")," (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=ssl_enable%3DYES%20allow_anon_ssl%3DNO%20force_local_data_ssl%3DYES%20force_local_logins_ssl%3DYES%20ssl_tlsv1%3DYES,ssl_sslv2%3DNO%20ssl_sslv3%3DNO"},"Secure FTP Server - vsftpd - Documentation"),"), so the server rejects any attempt to send credentials or files without TLS. If the camera for some reason cannot do FTPS (older firmware, etc.), at minimum try to keep the FTP server on a trusted, closed network.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Firewall and Network Restrictions:")," Since an FTP server can be a target, restrict network access to it. If possible, ",(0,n.kt)("strong",{parentName:"p"},"allow connections only from the camera\u2019s IP or the local LAN"),". The Reddit CCTV thread specifically suggests not exposing the FTP server beyond the internal network (",(0,n.kt)("a",{parentName:"p",href:"https://www.reddit.com/r/linux4noobs/comments/ukq1eu/i_need_an_ftp_server_for_cctv_i_tried_and_failed/#:~:text=The%20FTP%20server%20should%20not,the%20camera%20takes%20the%20processing"},"I need an FTP server for CCTV, i tried and failed, so reaching out... : r/linux4noobs"),"). Use Ubuntu\u2019s UFW or iptables to block port 21 from the internet. If you need remote access to the footage, consider using a VPN into your network rather than opening FTP to the world. Also, use vsftpd\u2019s built-in controls like ",(0,n.kt)("inlineCode",{parentName:"p"},"listen_address")," (to bind to a specific interface if needed) or TCP wrappers (vsftpd can respect /etc/hosts.allow and /etc/hosts.deny). In short, ",(0,n.kt)("strong",{parentName:"p"},"isolate the FTP service")," as much as possible. It should ideally only communicate with your cameras, not arbitrary hosts.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Disable Unneeded Features:")," We already covered disabling ",(0,n.kt)("inlineCode",{parentName:"p"},"anonymous_enable"),". Also ensure ",(0,n.kt)("inlineCode",{parentName:"p"},"write_enable=YES")," (so that your camera can upload files) but ",(0,n.kt)("strong",{parentName:"p"},"consider disabling any FTP commands the camera doesn\u2019t need"),". For example, if the camera only ever uploads and never reads files back or deletes them, you could set ",(0,n.kt)("inlineCode",{parentName:"p"},"download_enable=NO")," (to prevent any downloads from the server) and ",(0,n.kt)("inlineCode",{parentName:"p"},"cmds_allowed"),"/",(0,n.kt)("inlineCode",{parentName:"p"},"cmds_denied")," to restrict deletion or rename commands. This might be overkill, but it's an option. By default, vsftpd allows downloads of files the user has access to. If you want to protect the footage from being downloaded via FTP (say, in case the camera or credentials are compromised), you can set ",(0,n.kt)("inlineCode",{parentName:"p"},"download_enable=NO")," to block all RETR commands (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=download_enable%20If%20set%20to%20NO%2C,requests%20will%20give%20permission%20denied"},"Manpage of VSFTPD.CONF"),"), effectively making the FTP an \u201cupload-only dropbox.\u201d Keep in mind the camera itself typically doesn\u2019t need to retrieve files \u2013 it only sends them \u2013 so this can be a valid security measure. At minimum, ",(0,n.kt)("strong",{parentName:"p"},"limit the FTP user\u2019s privileges")," on the filesystem: the user account should only have write access to its upload directory and not to other sensitive locations.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"User Isolation and Accounts:")," If you have multiple cameras, ",(0,n.kt)("strong",{parentName:"p"},"give each camera its own FTP account and directory if possible"),". This way, each camera writes to its own chrooted area. Even if one camera's credentials are compromised, an attacker won't automatically get access to the others\u2019 footage. vsftpd can be configured such that multiple local users each have their own ",(0,n.kt)("inlineCode",{parentName:"p"},"local_root")," directory (or you simply set their home directories differently). For instance, you might have ",(0,n.kt)("inlineCode",{parentName:"p"},"/ftp/cam1"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"/ftp/cam2"),", each owned by the respective user and chrooted. This is more of a defense-in-depth strategy. If managing multiple accounts is too burdensome, at least configure the camera to use distinct sub-folders for each device. MyIPCameraBrand\u2019s FTP settings allow specifying a ",(0,n.kt)("em",{parentName:"p"},"Remote Directory")," (folder) for uploads \u2013 utilize that to segregate files by camera (e.g., camera1 uploads to ",(0,n.kt)("inlineCode",{parentName:"p"},"/cam1")," folder, camera2 to ",(0,n.kt)("inlineCode",{parentName:"p"},"/cam2"),").")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Enable Logging and Monitor:")," vsftpd can log FTP transactions. Make sure ",(0,n.kt)("inlineCode",{parentName:"p"},"xferlog_enable=YES")," is set so uploads are recorded to ",(0,n.kt)("inlineCode",{parentName:"p"},"/var/log/xferlog")," (and/or enable ",(0,n.kt)("inlineCode",{parentName:"p"},"dual_log_enable=YES")," for verbose logging in ",(0,n.kt)("inlineCode",{parentName:"p"},"/var/log/vsftpd.log"),") (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=dual_log_enable%20If%20enabled%2C%20two%20log,is%20vsftpd%27s%20own%20style%20log"},"Manpage of VSFTPD.CONF"),"). Review logs periodically to see if there are failed login attempts or strange activity. For example, multiple unknown IPs trying to login could indicate a brute-force attempt. Because this is a non-interactive service for a camera, you might employ ",(0,n.kt)("strong",{parentName:"p"},"fail2ban")," on the vsftpd log to ban IPs with too many failed logins (though if the service is truly LAN-only, this is less of a concern). Logging also helps troubleshoot if the camera fails to upload at times \u2013 you can correlate timestamps and error messages.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Additional Hardening:")," Other vsftpd settings to consider for security include ",(0,n.kt)("inlineCode",{parentName:"p"},"hide_ids=YES")," (so that user/group IDs are shown numerically in directory listings, not actual usernames \u2013 this is minor, but it prevents leaking system username info to FTP clients) (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=chroot_local_user%3DYES%20allow_writeable_chroot%3DYES%20hide_ids%3DYES"},"Secure FTP Server - vsftpd - Documentation"),"). You can also use ",(0,n.kt)("inlineCode",{parentName:"p"},"userlist_enable=YES")," with ",(0,n.kt)("inlineCode",{parentName:"p"},"userlist_deny=NO")," and list your camera user in ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/vsftpd.user_list")," \u2013 this configuration makes vsftpd ",(0,n.kt)("em",{parentName:"p"},"allow only")," users on that list to login (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=It%20is%20possible%20to%20prevent,etc%2Fvsftpd.conf"},"Very Secure FTP Daemon - ArchWiki"),") (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=userlist_deny%3DNO"},"Very Secure FTP Daemon - ArchWiki"),"). That way, even if someone finds a way to attempt other usernames, vsftpd will reject them outright if they're not on the allow-list. Since in your case likely only one user (or a few camera users) should ever log in, this whitelisting adds another layer of protection.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Stay Updated on Security Patches:")," Keep vsftpd updated via Ubuntu\u2019s package manager. This will ensure you have the latest security fixes. There have been instances of vsftpd vulnerabilities in the past \u2013 for example, a backdoored vsftpd version 2.3.4 (in 2011) allowed attackers to gain root via a special login sequence (",(0,n.kt)("a",{parentName:"p",href:"https://www.incibe.es/en/incibe-cert/early-warning/vulnerabilities/cve-2011-2523#:~:text=CVE,a%20shell%20on%20port%206200%2Ftcp"},"CVE-2011-2523 | INCIBE-CERT"),"), and more recently, a denial-of-service issue was noted in vsftpd 3.0.3 where an attacker could exhaust connections (",(0,n.kt)("a",{parentName:"p",href:"https://nvd.nist.gov/vuln/detail/CVE-2021-30047#:~:text=CVE,limited%20number%20of%20connections%20allowed"},"CVE-2021-30047 Detail - NVD"),"). While these specific issues may be rare, running the latest version mitigates known problems. The ",(0,n.kt)("strong",{parentName:"p"},"principle of least exposure")," applies: disable what you don't need (anonymous logins, unnecessary commands) and update what you do run. As one hardening guide succinctly puts it: ",(0,n.kt)("em",{parentName:"p"},'"Keeping vsftpd and its dependencies up-to-date is essential for protecting against vulnerabilities and exploits."')," (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Regularly%20Update%20vsftpd"},"vsftpd Server Hardening | Hackviser"),").")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Test with the Camera and a Client:"),' After applying security settings, test the FTP access using a regular FTP client (like FileZilla or the command line) with the same credentials as the camera, to ensure you can upload and list files as expected. Then test from the camera itself (MyIPCameraBrand has a "Test FTP" button in its interface). If you enforced FTPS, make sure the camera\'s FTPS mode is on, otherwise the test will fail. Also verify whether the camera is using passive or active FTP and that your configuration accommodates it (see next section on performance for more on this). '))),(0,n.kt)("p",null,"In summary, treat the FTP server for what it is \u2013 a specialized file drop for your camera. Lock it down to just that purpose. Use encryption, strong authentication, and isolation to minimize the attack surface and potential impact."),(0,n.kt)("h2",{id:"performance-and-system-reliability-considerations"},"Performance and System Reliability Considerations"),(0,n.kt)("p",null,"A securely configured vsftpd server must also perform well to reliably handle continuous camera uploads. The good news is that vsftpd is designed to be ",(0,n.kt)("strong",{parentName:"p"},"lightweight and fast"),". It has a small memory footprint and efficient code, which is one reason it's widely used (even by major Linux distributions for their package repositories). In fact, vsftpd is described as ",(0,n.kt)("em",{parentName:"p"},"\u201ca very tiny and compact FTP server written with speed and security in mind. It performs really well on high-speed local networks.\u201d")," (",(0,n.kt)("a",{parentName:"p",href:"https://linuxreviews.org/Comparison_of_FTP_servers#:~:text=The%20very%20light"},"Comparison of FTP servers - LinuxReviews"),"). Here are some performance and reliability points to consider:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Resource Usage:")," For a single MyIPCameraBrand camera uploading clips or images, vsftpd will hardly stress a modern server. Even on modest hardware (like a Raspberry Pi or an old PC), vsftpd can handle multiple connections concurrently. A community user noted that ",(0,n.kt)("em",{parentName:"p"},"\u201cvsftpd was quite lean under minimal load\u201d")," even on an old machine (",(0,n.kt)("a",{parentName:"p",href:"https://www.reddit.com/r/linux4noobs/comments/ukq1eu/i_need_an_ftp_server_for_cctv_i_tried_and_failed/#:~:text=%E2%80%A2%20%E2%80%A2%20Edited"},"I need an FTP server for CCTV, i tried and failed, so reaching out... : r/linux4noobs"),"). Unless you have dozens of cameras or are writing to a slow disk, the daemon itself won't be a bottleneck. The limiting factor is more likely to be network bandwidth or disk I/O (writing the video files). Ensure your storage can sustain the write throughput (especially if recording high-resolution video continuously). Using a dedicated disk or partition for camera footage can help isolate any heavy I/O.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Concurrent Connections:")," By default, vsftpd may limit the number of clients and connections per IP. For example, a default config might set ",(0,n.kt)("inlineCode",{parentName:"p"},"max_clients=50")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"max_per_ip=2")," (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=The%20data%20transfer%20rate%2C%20i,etc%2Fvsftpd.conf"},"Very Secure FTP Daemon - ArchWiki"),"). This is to prevent overload and abuse. Typically, one camera will use at most 1-2 connections at a time (FTP opens a control connection and may open a data connection for each transfer). If you have multiple cameras, each will use its own session. 50 total clients is plenty in most cases, but if you plan to connect many devices or allow simultaneous FTP downloads of footage (multiple clients), you might raise this limit. Conversely, if this is a single-purpose server for one camera, you could ",(0,n.kt)("em",{parentName:"p"},"lower")," these limits to, say, ",(0,n.kt)("inlineCode",{parentName:"p"},"max_clients=5")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"max_per_ip=2")," to reduce the impact of any misbehaving client. The key is to avoid a scenario where connections are exhausted. A CVE report in 2021 pointed out that vsftpd's connection limit could be abused to cause a denial of service (an attacker opening many connections to block others) (",(0,n.kt)("a",{parentName:"p",href:"https://nvd.nist.gov/vuln/detail/CVE-2021-30047#:~:text=CVE,limited%20number%20of%20connections%20allowed"},"CVE-2021-30047 Detail - NVD"),"). Mitigate that by keeping ",(0,n.kt)("inlineCode",{parentName:"p"},"max_per_ip")," low (so one host can't hog all slots) (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Implement%20Rate%20Limiting%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),"), and using a firewall to block IPs that open too many connections or aren\u2019t recognized.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Active vs Passive FTP Modes:")," MyIPCameraBrand cameras support both ",(0,n.kt)("strong",{parentName:"p"},"PORT (Active)")," and ",(0,n.kt)("strong",{parentName:"p"},"PASV (Passive)"),' modes (and an "Auto" setting) for FTP transfers. This can affect performance and connectivity:'),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"In ",(0,n.kt)("strong",{parentName:"p"},"Active mode"),", the camera (client) asks the server to connect back to a specified data port on the camera (default server data port is 20). This works well in LAN environments but can fail if the camera or server is behind NAT firewalls that block incoming connections. If your camera is on the same local network as the server, active mode is fine. Just ensure the server\u2019s firewall allows outbound connections from port 20 (ftp-data) or set ",(0,n.kt)("inlineCode",{parentName:"p"},"connect_from_port_20=YES")," in vsftpd (enabled by default in many configs for security) (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=connect_from_port_20%20This%20controls%20whether%20PORT,run%20with%20slightly%20less%20privilege"},"Manpage of VSFTPD.CONF"),"). Active mode can sometimes be more efficient on LAN because it doesn\u2019t require configuring a passive port range.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"In ",(0,n.kt)("strong",{parentName:"p"},"Passive mode"),", the server opens a port for data and the client connects to it. This is easier for clients behind NAT (since the client initiates both control and data connections). For passive mode, you should configure vsftpd with a specific passive port range (e.g., ",(0,n.kt)("inlineCode",{parentName:"p"},"pasv_min_port=30000")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"pasv_max_port=31000"),", or similar high, unused ports) and open those ports in the firewall (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Configure%20Passive%20Port%20Range%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),"). MyIPCameraBrand's documentation suggests using Auto mode, which will try passive first, then active. If you notice the camera struggling to transfer (e.g., test file is created but remains empty, or transfers hang), it could be an FTP mode issue. Community users have resolved such issues by switching modes: ",(0,n.kt)("em",{parentName:"p"},"\u201cTry changing the FTP mode to Passive\u201d")," was a solution offered on MyIPCameraBrand\u2019s forum for a similar problem. Passive mode issues often relate to firewall/NAT, so proper configuration of the port range is key. Performance-wise, there\u2019s little difference between active and passive once set up, but passive may use a random port for each transfer within the range \u2013 ensure your system can handle the ephemeral ports without issue.")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"System Reliability:")," Since this is likely a 24/7 service receiving camera data, ensure vsftpd is set to start on boot (",(0,n.kt)("inlineCode",{parentName:"p"},"systemctl enable vsftpd"),"). The daemon is quite stable; there are rarely crashes reported. If vsftpd were to hang or crash under load (unlikely under normal use), it would interrupt recordings. One potential stress factor could be if the camera triggers many rapid connections or file creations (for example, some cameras upload a new image every second on motion). vsftpd can handle rapid file turnover, but you should monitor memory and CPU if you increase such loads. The use of text logs (xferlog) means every upload results in a disk write to the log; this overhead is minor, but on a very busy system, rotating logs is advisable to prevent them from growing indefinitely.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Failover and Backup:")," Consider what happens if the FTP server is down or unreachable \u2013 the camera might not be able to store its footage (some cameras have internal SD cards as backup, others might just drop the frames). To improve reliability, ensure your server has a UPS (if power loss is a concern) and that the storage has enough space (implement monitoring or alerts for disk usage, so it doesn't fill up and cause failures). Performance tuning isn't just about speed, but also about ",(0,n.kt)("strong",{parentName:"p"},"consistency")," \u2013 you want the FTP always available when the camera tries to send data.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Multiple Cameras and Throughput:")," If you add more cameras in the future, monitor how simultaneous uploads affect network and disk. vsftpd is efficient at handling concurrent sessions, as noted by users who have run it for multiple clients ",(0,n.kt)("em",{parentName:"p"},"\u201cwith minimal load\u201d")," (",(0,n.kt)("a",{parentName:"p",href:"https://www.reddit.com/r/linux4noobs/comments/ukq1eu/i_need_an_ftp_server_for_cctv_i_tried_and_failed/#:~:text=%E2%80%A2%20%E2%80%A2%20Edited"},"I need an FTP server for CCTV, i tried and failed, so reaching out... : r/linux4noobs"),") (",(0,n.kt)("a",{parentName:"p",href:"https://www.reddit.com/r/linux4noobs/comments/ukq1eu/i_need_an_ftp_server_for_cctv_i_tried_and_failed/#:~:text=Now%20I%20see%20that%20I,you%27re%20lucky%20to%20sidestep%20it"},"I need an FTP server for CCTV, i tried and failed, so reaching out... : r/linux4noobs"),"). It can even handle high-throughput scenarios (for instance, vsftpd was used by Debian for their package mirror network, which implies robust performance under heavy traffic) (",(0,n.kt)("a",{parentName:"p",href:"https://www.reddit.com/r/linux4noobs/comments/ukq1eu/i_need_an_ftp_server_for_cctv_i_tried_and_failed/#:~:text=Now%20I%20see%20that%20I,you%27re%20lucky%20to%20sidestep%20it"},"I need an FTP server for CCTV, i tried and failed, so reaching out... : r/linux4noobs"),"). Nonetheless, each camera streaming video will consume network bandwidth; if your server is also used for other tasks, you might need to ensure there's no contention (perhaps using QoS on your router or a separate network for cameras). On the disk side, if multiple cameras write simultaneously to the same drive, using an SSD or fast HDD will help prevent any I/O bottlenecks.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Regular Maintenance:")," For long-term reliability, implement log rotation (Ubuntu typically has logrotate configured for vsftpd logs by default), and clean up old recordings if your setup doesn't do so automatically. MyIPCameraBrand cameras often have an option to overwrite or not overwrite files on the FTP server. If not overwriting, the FTP directory will grow indefinitely \u2013 plan for how to archive or delete old footage so the server doesn't run out of space. This isn't a vsftpd configuration issue per se, but it's part of maintaining a reliable recording system.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Testing and Monitoring:")," Periodically test the FTP throughput by uploading a large file from a PC to simulate a heavy load, ensuring vsftpd handles it without throttling excessively or failing. vsftpd can also enforce a bandwidth limit per user (",(0,n.kt)("inlineCode",{parentName:"p"},"local_max_rate"),") (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=The%20data%20transfer%20rate%2C%20i,etc%2Fvsftpd.conf"},"Very Secure FTP Daemon - ArchWiki"),"), which you normally wouldn\u2019t set for an internal camera (you want it to use full available bandwidth), but be aware of it if you see uploads capped unexpectedly. Check CPU usage when the camera is uploading via FTPS \u2013 TLS encryption will use some CPU. On a modern CPU or even a Raspberry Pi 4, this should be fine; encryption overhead for a single stream of video is usually manageable, but keep an eye on it if you run on very low-end hardware."))),(0,n.kt)("p",null,"In summary, ",(0,n.kt)("strong",{parentName:"p"},"vsftpd\u2019s performance is generally a strong point"),", and by following the above practices you can ensure it remains reliable under your camera\u2019s workload. Most users find vsftpd \u201cfast, stable, and more than good enough for production systems\u201d (",(0,n.kt)("a",{parentName:"p",href:"https://linuxreviews.org/Comparison_of_FTP_servers#:~:text=So%20what%27s%20wrong%20with%20Pure"},"Comparison of FTP servers - LinuxReviews"),"), especially when configured with sensible limits. Just keep the server environment healthy (updates, disk space, network stability) and it will serve your MyIPCameraBrand camera reliably."),(0,n.kt)("h2",{id:"recommended-configuration--mitigation-summary"},"Recommended Configuration & Mitigation Summary"),(0,n.kt)("p",null,"Bringing it all together, here are the ",(0,n.kt)("strong",{parentName:"p"},"key configurations and measures")," to implement for a secure and robust vsftpd setup for IP camera recordings:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Disable Anonymous Access:")," Ensure that anonymous logins are turned off. In ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/vsftpd.conf"),", set ",(0,n.kt)("inlineCode",{parentName:"p"},"anonymous_enable=NO")," (and make sure the line isn\u2019t commented out) (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=vi%20%2Fetc%2Fvsftpd%2Fvsftpd"},"Secure FTP Server - vsftpd - Documentation"),"). This forces the camera to use the credentials you set, preventing unwanted guests on the FTP server.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Use a Dedicated FTP User Account:")," Create a local Linux user (e.g., ",(0,n.kt)("inlineCode",{parentName:"p"},"ipcamftp"),") specifically for the camera. Give it a strong password and set its shell to nologin. This user will own the directory where recordings are stored. In vsftpd, have ",(0,n.kt)("inlineCode",{parentName:"p"},"local_enable=YES")," (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=anonymous_enable%3DNO"},"Secure FTP Server - vsftpd - Documentation"),") to allow local user logins. Do not reuse an admin or personal account for this \u2013 use a limited user just for FTP.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Chroot the FTP User:")," Add ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_local_user=YES")," to vsftpd.conf (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=chroot_local_user%20If%20set%20to%20YES%2C,jails"},"Manpage of VSFTPD.CONF"),") so that by default all local FTP users (in this case, mainly your camera user) are jailed in their home directories. This prevents the camera (or anyone using its account) from navigating to other folders on the server. As a safeguard, you can list any non-camera users in ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/vsftpd.chroot_list")," and set ",(0,n.kt)("inlineCode",{parentName:"p"},"chroot_list_enable=YES")," to exempt them, but on a dedicated server this is usually not needed (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=chroot_local_user%3DYES"},"Very Secure FTP Daemon - ArchWiki"),").")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Configure Secure Directory Permissions:")," To satisfy vsftpd\u2019s security model, make the chroot base directory non-writable by the FTP user. For example, if the home is ",(0,n.kt)("inlineCode",{parentName:"p"},"/var/ftp/cam"),", do ",(0,n.kt)("inlineCode",{parentName:"p"},"chown root:root /var/ftp/cam")," and perhaps ",(0,n.kt)("inlineCode",{parentName:"p"},"chmod 755"),". Then create a subfolder ",(0,n.kt)("inlineCode",{parentName:"p"},"/var/ftp/cam/uploads")," (owned by the ftp user) where the camera will actually upload files. Alternatively, if you prefer a simpler setup, enable the config ",(0,n.kt)("inlineCode",{parentName:"p"},"allow_writeable_chroot=YES")," (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=that%20shown%20here%3A"},"Secure FTP Server - vsftpd - Documentation"),") to let the FTP user write in the root of their home \u2013 ",(0,n.kt)("strong",{parentName:"p"},"but"),' remember this has a security implication (the "chroot escape" risk) (',(0,n.kt)("a",{parentName:"p",href:"https://serverfault.com/questions/743949/vsftp-why-is-allow-writeable-chroot-yes-a-bad-idea#:~:text=If%20the%20FTP%20credentials%20of,This%20escalates%20the%20attack"},"security - vsftp: why is allow_writeable_chroot=YES a bad idea? - Server Fault"),") (",(0,n.kt)("a",{parentName:"p",href:"https://serverfault.com/questions/743949/vsftp-why-is-allow-writeable-chroot-yes-a-bad-idea#:~:text=server%20that%20induces%20it%20to,to%20rooting%20the%20entire%20machine"},"security - vsftp: why is allow_writeable_chroot=YES a bad idea? - Server Fault"),"). The more secure approach is the former (non-writable home with a writable subdirectory), which avoids that risk entirely.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Enforce FTPS Encryption:")," Enable SSL/TLS on the server: ",(0,n.kt)("inlineCode",{parentName:"p"},"ssl_enable=YES")," (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Enforce%20FTPS%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),"), and set up the certificate (",(0,n.kt)("inlineCode",{parentName:"p"},"rsa_cert_file")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"rsa_private_key_file"),"). It\u2019s wise to also add ",(0,n.kt)("inlineCode",{parentName:"p"},"force_local_logins_ssl=YES")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"force_local_data_ssl=YES")," so that ",(0,n.kt)("strong",{parentName:"p"},"no")," login or file transfer is accepted without encryption (",(0,n.kt)("a",{parentName:"p",href:"https://docs.rockylinux.org/guides/file_sharing/secure_ftp_server_vsftpd/#:~:text=ssl_enable%3DYES%20allow_anon_ssl%3DNO%20force_local_data_ssl%3DYES%20force_local_logins_ssl%3DYES%20ssl_tlsv1%3DYES,ssl_sslv2%3DNO%20ssl_sslv3%3DNO"},"Secure FTP Server - vsftpd - Documentation"),") (if the camera is configured for FTPS it will comply). On the MyIPCameraBrand camera, check \u201cFTPS Only\u201d in the FTP settings to make it use FTPS. This ensures your footage and credentials aren\u2019t sent in plaintext over the network. If the camera has issues with FTPS (some users reported needing specific settings), double-check that you\u2019re using explicit FTPS on port 21 (the camera does not support implicit FTPS on 990). You might also restrict the TLS protocol to strong versions and ciphers (e.g., ",(0,n.kt)("inlineCode",{parentName:"p"},"ssl_tlsv1=YES"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"ssl_sslv2=NO"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"ssl_sslv3=NO"),", and ",(0,n.kt)("inlineCode",{parentName:"p"},"ssl_ciphers=HIGH"),") (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Employ%20Strong%20Encryption%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),") for better security.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Limit Access to Trusted Hosts:")," Use a firewall (ufw or iptables) to allow FTP (and FTPS) ports only from the IP range of your cameras or your LAN (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Use%20Firewall%20to%20Restrict%20Access"},"vsftpd Server Hardening | Hackviser"),"). If your camera is on the same local network, you can block port 21 on the WAN interface entirely. This mitigates a huge class of threats (internet bots scanning for FTP servers). Additionally, within vsftpd you can use ",(0,n.kt)("inlineCode",{parentName:"p"},"userlist_enable=YES")," with ",(0,n.kt)("inlineCode",{parentName:"p"},"userlist_deny=NO")," and put only your camera\u2019s user in ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/vsftpd.user_list")," (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=userlist_enable%3DYES%20userlist_file%3D%2Fetc%2Fvsftpd"},"Very Secure FTP Daemon - ArchWiki"),"). This way, vsftpd will deny login attempts for any user not on the list, even if they somehow got a password.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Tune Passive/Active Settings:")," If behind NAT or firewall, set up a passive port range in vsftpd.conf (e.g., ",(0,n.kt)("inlineCode",{parentName:"p"},"pasv_min_port=30000")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"pasv_max_port=30010")," for a small range) (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Configure%20Passive%20Port%20Range%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),") and open those ports. Also set ",(0,n.kt)("inlineCode",{parentName:"p"},"pasv_address")," if the camera needs to reach the server via an external IP. Conversely, if using active mode, ensure ",(0,n.kt)("inlineCode",{parentName:"p"},"connect_from_port_20=YES")," so data comes from port 20 (which some clients/firewalls expect) (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=connect_from_port_20%20This%20controls%20whether%20PORT,run%20with%20slightly%20less%20privilege"},"Manpage of VSFTPD.CONF"),"). MyIPCameraBrand suggests \u201cAuto\u201d mode for transfers \u2013 test and see which mode works reliably and optimize accordingly. Properly configured, either mode should be fine on a LAN.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Apply Connection Limits and Brute-Force Protection:")," Keep the default or stricter limits on connections unless you have a reason to change them. For example, ",(0,n.kt)("inlineCode",{parentName:"p"},"max_clients=10")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"max_per_ip=3")," is plenty for a few cameras and prevents any single host from flooding the server (",(0,n.kt)("a",{parentName:"p",href:"https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon#:~:text=The%20data%20transfer%20rate%2C%20i,etc%2Fvsftpd.conf"},"Very Secure FTP Daemon - ArchWiki"),"). As an extra layer, you can integrate ",(0,n.kt)("strong",{parentName:"p"},"fail2ban")," to watch vsftpd logs \u2013 although if the server is LAN-only and uses strong passwords, brute-force attempts are unlikely. Still, it's good practice to mitigate brute-force login attempts by either rate-limiting (",(0,n.kt)("inlineCode",{parentName:"p"},"max_login_fails"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"delay_failed_login"),") or using an external tool. The hackviser hardening guide even suggests setting ",(0,n.kt)("inlineCode",{parentName:"p"},"max_per_ip=5")," to throttle connections per host (",(0,n.kt)("a",{parentName:"p",href:"https://hackviser.com/tactics/hardening/vsftpd#:~:text=Implement%20Rate%20Limiting%20%28vsftpd"},"vsftpd Server Hardening | Hackviser"),"). Tailor this to your environment; just avoid unlimited connections which could be abused.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Maintain Logs and Auditing:")," Ensure ",(0,n.kt)("inlineCode",{parentName:"p"},"xferlog_enable=YES")," (it\u2019s usually on by default in vsftpd\u2019s example config) and consider ",(0,n.kt)("inlineCode",{parentName:"p"},"dual_log_enable=YES")," for a more detailed log (",(0,n.kt)("a",{parentName:"p",href:"https://security.appspot.com/vsftpd/vsftpd_conf.html#:~:text=dual_log_enable%20If%20enabled%2C%20two%20log,is%20vsftpd%27s%20own%20style%20log"},"Manpage of VSFTPD.CONF"),"). This will record every file transfer and login. Monitor these logs for anomalies (like frequent reconnects, which might indicate connection problems, or unknown IPs). Logging imposes minimal overhead but provides invaluable information if something goes wrong or if you need to investigate a security incident.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Keep Software Updated:")," Regularly install updates for vsftpd through Ubuntu\u2019s package management. This will include security patches. As noted, vsftpd historically had a few critical vulnerabilities that have since been fixed (e.g., a backdoor in a compromised 2.3.4 version (",(0,n.kt)("a",{parentName:"p",href:"https://www.incibe.es/en/incibe-cert/early-warning/vulnerabilities/cve-2011-2523#:~:text=CVE,a%20shell%20on%20port%206200%2Ftcp"},"CVE-2011-2523 | INCIBE-CERT"),"), and a denial-of-service vector in older versions (",(0,n.kt)("a",{parentName:"p",href:"https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=vsftpd#:~:text=Unspecified%20vulnerability%20in%20vsftpd%203,vectors%2C%20related%20to%20deny_file"},"CVE - Search Results - MITRE Corporation"),")). Running an updated version ensures you have those fixes. Also update the system\u2019s OpenSSL library, since FTPS security depends on it.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Plan for Failures:")," Although vsftpd is stable, have a plan: ensure the service auto-starts on boot (",(0,n.kt)("inlineCode",{parentName:"p"},"systemctl enable vsftpd"),"), and consider monitoring the FTP service (using a script or monitoring tool to alert you if the FTP goes down or if camera stops uploading). This way you can respond quickly to any downtime and not lose critical recordings. "))),(0,n.kt)("p",null,"By following these recommendations, you create a secure environment for your MyIPCameraBrand (or any similar IP camera) to store footage via FTP. In summary, ",(0,n.kt)("strong",{parentName:"p"},"require authentication"),", ",(0,n.kt)("strong",{parentName:"p"},"jail each user to its folder"),", ",(0,n.kt)("strong",{parentName:"p"},"encrypt the connection"),", ",(0,n.kt)("strong",{parentName:"p"},"minimize exposure"),", and ",(0,n.kt)("strong",{parentName:"p"},"stay on top of updates"),". These measures address the key security risks (unauthorized access, data interception, exploitation of the FTP service) while maintaining the functionality needed for the camera to do its job. The result should be a robust FTP setup that runs efficiently and safely, letting you leverage vsftpd\u2019s strengths \u2013 ",(0,n.kt)("em",{parentName:"p"},"\u201csecure and extremely fast, and it is stable\u201d")," (",(0,n.kt)("a",{parentName:"p",href:"https://www.layerstack.com/resources/tutorials/How-to-set-up-configure-secure-vsFTPd-on-Linux-Cloud-Servers?srsltid=AfmBOorkokDhoeOxSVWd0V6M5933MTktXC9Yo_p92SI2AyL4yYbvVqBm#:~:text=The%20vsftpd%20is%20the%20default,fast%2C%20and%20it%20is%20stable"},"How to set up, configure & secure vsFTPd on Linux Cloud Servers"),") \u2013 for your home or business surveillance needs."))}d.isMDXComponent=!0}}]);
<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-personal-site/notebook">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Development Notebook | James&#x27; Tech Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://notebook.james.codes/docs/personal-site/notebook"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Development Notebook | James&#x27; Tech Notes"><meta data-rh="true" name="description" content="May 4, 2024"><meta data-rh="true" property="og:description" content="May 4, 2024"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://notebook.james.codes/docs/personal-site/notebook"><link data-rh="true" rel="alternate" href="https://notebook.james.codes/docs/personal-site/notebook" hreflang="en"><link data-rh="true" rel="alternate" href="https://notebook.james.codes/docs/personal-site/notebook" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="James&#39; Tech Notes RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="James&#39; Tech Notes Atom Feed"><link rel="stylesheet" href="/assets/css/styles.6cc89222.css">
<link rel="preload" href="/assets/js/runtime~main.d96171f6.js" as="script">
<link rel="preload" href="/assets/js/main.2354cdf8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/projects"><div class="navbar__logo"><img src="/img/jw.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/jw.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/projects">Projects</a></div><div class="navbar__items navbar__items--right"><a href="https://jameswood.dev/resume" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Resume<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/James-D-Wood" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/projects">Projects Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/personal-site">Personal Site</a><button aria-label="Toggle the collapsible sidebar category &#x27;Personal Site&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/personal-site/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/features">Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Features&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/personal-site/notebook">Development Notebook</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/home-lab">Home Lab</a><button aria-label="Toggle the collapsible sidebar category &#x27;Home Lab&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/recipe-app">Recipe App</a><button aria-label="Toggle the collapsible sidebar category &#x27;Recipe App&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/json-formatter-chrome-extension">JSON Formatter Chrome Extension</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/personal-site"><span itemprop="name">Personal Site</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Development Notebook</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Development Notebook</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="may-4-2024">May 4, 2024<a class="hash-link" href="#may-4-2024" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-meta-endpoint">Creating the /meta endpoint<a class="hash-link" href="#creating-the-meta-endpoint" title="Direct link to heading">​</a></h3><p>Today I wanted to set up an endpoint to share service metadata such as commit
SHA and build time to help serve as a reminder to me when I last was working
on this project and what version of the code I had last deployed. I often go
long stretches between working on my personal projects depending on how busy
life gets and having this as quick reference helps me dive back in where I
left off.</p><p>The learning from this was how to use <code>go generate</code> in my build steps to
generate txt files with the metadata I wanted to include and use <code>go embed</code>
to tie these values to variables at runtime. The relevant code looks like
this:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token comment" style="color:#9598C7">//go:generate sh -c &quot;printf %s $(git rev-parse HEAD) &gt; .build/commit.txt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token comment" style="color:#9598C7">//go:generate sh -c &quot;date -u -I seconds | tr -d &#x27;[:space:]&#x27; &gt; .build/build-time.txt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token keyword" style="color:#EBC6F7">var</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    </span><span class="token comment" style="color:#9598C7">//go:embed .build/commit.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    Commit </span><span class="token builtin" style="color:#bcc0fb">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    </span><span class="token comment" style="color:#9598C7">//go:embed .build/build-time.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    BuildTime </span><span class="token builtin" style="color:#bcc0fb">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token keyword" style="color:#EBC6F7">type</span><span class="token plain"> MetaResponse </span><span class="token keyword" style="color:#EBC6F7">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    CommitSHA </span><span class="token builtin" style="color:#bcc0fb">string</span><span class="token plain"> </span><span class="token string" style="color:#BEC1ED">`json:&quot;sha&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    BuildTime </span><span class="token builtin" style="color:#bcc0fb">string</span><span class="token plain"> </span><span class="token string" style="color:#BEC1ED">`json:&quot;build_time&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    GitHubURL </span><span class="token builtin" style="color:#bcc0fb">string</span><span class="token plain"> </span><span class="token string" style="color:#BEC1ED">`json:&quot;github_url&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token punctuation" style="color:#D0C6F7">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token keyword" style="color:#EBC6F7">func</span><span class="token plain"> </span><span class="token function" style="color:#CCEBFF">metaHandler</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">w http</span><span class="token punctuation" style="color:#D0C6F7">.</span><span class="token plain">ResponseWriter</span><span class="token punctuation" style="color:#D0C6F7">,</span><span class="token plain"> r </span><span class="token operator" style="color:#D0C6F7">*</span><span class="token plain">http</span><span class="token punctuation" style="color:#D0C6F7">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    b</span><span class="token punctuation" style="color:#D0C6F7">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">_</span><span class="token plain"> </span><span class="token operator" style="color:#D0C6F7">:=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#D0C6F7">.</span><span class="token function" style="color:#CCEBFF">Marshal</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">MetaResponse</span><span class="token punctuation" style="color:#D0C6F7">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">        Commit</span><span class="token punctuation" style="color:#D0C6F7">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">        BuildTime</span><span class="token punctuation" style="color:#D0C6F7">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">        </span><span class="token string" style="color:#BEC1ED">&quot;https://github.com/James-D-Wood/personal-site-go-server&quot;</span><span class="token punctuation" style="color:#D0C6F7">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    </span><span class="token punctuation" style="color:#D0C6F7">}</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    w</span><span class="token punctuation" style="color:#D0C6F7">.</span><span class="token function" style="color:#CCEBFF">Header</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token punctuation" style="color:#D0C6F7">.</span><span class="token function" style="color:#CCEBFF">Add</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token string" style="color:#BEC1ED">&quot;Content-Type&quot;</span><span class="token punctuation" style="color:#D0C6F7">,</span><span class="token plain"> </span><span class="token string" style="color:#BEC1ED">&quot;application/json&quot;</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    w</span><span class="token punctuation" style="color:#D0C6F7">.</span><span class="token function" style="color:#CCEBFF">Write</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token punctuation" style="color:#D0C6F7">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And here is what I see when I ping the new endpoint:</p><p><img loading="lazy" alt="/meta endpoint repsonse" src="/assets/images/meta-24144eb4ec28c045e3d2cfb57d0f13f2.png" width="1440" height="608" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="december-13-2021">December 13, 2021<a class="hash-link" href="#december-13-2021" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-site">Setting up the Site<a class="hash-link" href="#setting-up-the-site" title="Direct link to heading">​</a></h3><p>About a year ago I decided it was time to get my name out there for mostly me, my parents, and anyone clicking through my resume to see. This would involve publishing a personal website that would allow me to showcase myself as a developer through a simple blog and links to side projects. I could pretty simply be accomplished by a static site generator, a nice template and a monthly subscription to a managed hosting service - but what fun would that be? So I decided to set out some constraints for myself. This project needed to meet the following constraints:</p><ul class="contains-task-list containsTaskList_mC6p"><li class="task-list-item"><input type="checkbox" checked="" disabled=""> <!-- -->Give me more experience with technologies I&#x27;ve been interested in (Go, React, TypeScript, Tailwind, Docker)</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Explore &quot;microservice&quot; architecture (yet to be achieved in deployment)</li><li class="task-list-item"><input type="checkbox" checked="" disabled=""> <!-- -->Dip my toes in AWS</li><li class="task-list-item"><input type="checkbox" checked="" disabled=""> <!-- -->All for around $5 per month</li></ul><p>So like any good developer I bought a domain name, rented an EC2 instance, got the front end running and then proceeded to domain squat for 6 months. I&#x27;m finally getting around to launching the back end for this site and I&#x27;m finding that my lack of a CICD pipeline or even documentation is biting me in the behind. The following retraces my steps so that I can look back on this and hopefully learn, and so that others may possibly get a laugh.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="system-outline">System Outline<a class="hash-link" href="#system-outline" title="Direct link to heading">​</a></h3><p>To help with visualizing the walkthrough here is a basic diagram of the app at the beginning and at end of this article.During this walkthrough I will update the React client to no longer use hash routing, add a backend service run by systemd to serve as my API, install a PostgreSQL database and configure traffic through the Apache server I am already running.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="beginning-state">Beginning State<a class="hash-link" href="#beginning-state" title="Direct link to heading">​</a></h4><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">                                AWS EC2 Instance</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">     ---------------------------------------------</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                                              |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                               Front End      |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                  Serve       ------------    |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                 index.html  |            |   |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |               ------------&gt; |  React App |   |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |  www.*       |              |            |   |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |              |               ------------    |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |         ------------                         |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |        |            |                        |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">----|-------&gt;|   Apache   |                        |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |        |            |                        |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |         ------------                         |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                                              |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">     ----------------------------------------------</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="end-state">End State<a class="hash-link" href="#end-state" title="Direct link to heading">​</a></h4><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">                                AWS EC2 Instance</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">     ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                                                                        |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                               Front End                                |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                  Serve       ------------                              |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                 index.html  |            |                             |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |               ------------&gt; |  React App |                             |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |  www.*       |              |            |                             |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |              |               ------------                              |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |         ------------                                                   |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |        |            |                                                  |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">----|-------&gt;|   Apache   |           systemd service                        |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |        |            |       ---------------------                      |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |         ------------       |    Back End         |      Database       |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |              |             |     ------------    |    ------------     |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |  api.*       |             |    |            |   |   |            |    |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |               ------------&gt;|    | Golang API |&lt;-----&gt;| PostgreSQL |    |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                 Reverse    |    |            |   |   |            |    |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                  Proxy     |     ------------    |    ------------     |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                 to :8080   |                     |                     |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                             ---------------------                      |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    |                                                                        |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">     ------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="front-end-react-client">Front End (React Client)<a class="hash-link" href="#front-end-react-client" title="Direct link to heading">​</a></h3><p>I store the code for my front end publically on <a href="https://github.com/James-D-Wood/personal-site-react-ui" target="_blank" rel="noopener noreferrer">GitHub</a> if you are interested in viewing it! This client app acts as a mostly static site and hosts my resume, links to public projects, and developer notebook. The Dev Notebook portion requires connection to my backend which I will discuss next. If you are reading this article, spoiler alert: I was successful in deploying it.</p><p>Once my PR has been merged into <code>main</code>, I&#x27;m ready to deploy my code. Currently, I have a single EC2 instance that hosts my front end so deploying is a matter of SSH&#x27;ing into the box and manually pulling, building and running the code - I hope.</p><p>In the future I would like to update my process to allow myself to spin up a Docker container that does the majority of this for me and point my Apache server at that contatiner.</p><p>For now, the steps are as follows:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token function" style="color:#CCEBFF">ssh</span><span class="token plain"> myEC2Instance   </span><span class="token comment" style="color:#9598C7"># login data omitted for obvious reasons</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token builtin class-name" style="color:#bcc0fb">cd</span><span class="token plain"> ~/personal-site-react-ui</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token function" style="color:#CCEBFF">git</span><span class="token plain"> pull            </span><span class="token comment" style="color:#9598C7"># pull latest code from GitHub</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token function" style="color:#CCEBFF">npm</span><span class="token plain"> </span><span class="token function" style="color:#CCEBFF">install</span><span class="token plain">         </span><span class="token comment" style="color:#9598C7"># update and install dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token function" style="color:#CCEBFF">npm</span><span class="token plain"> run build       </span><span class="token comment" style="color:#9598C7"># this runs craco build behind the scenes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token comment" style="color:#9598C7"># .....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">Creating an optimized production build</span><span class="token punctuation" style="color:#D0C6F7">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token operator" style="color:#D0C6F7">&lt;</span><span class="token plain">--- Last few GCs ---</span><span class="token operator" style="color:#D0C6F7">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token number" style="color:#5a9bcf">6041</span><span class="token plain">:0x5023900</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain">   </span><span class="token number" style="color:#5a9bcf">932643</span><span class="token plain"> ms: Mark-sweep </span><span class="token number" style="color:#5a9bcf">247.0</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token number" style="color:#5a9bcf">258.6</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> -</span><span class="token operator" style="color:#D0C6F7">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">246.2</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token number" style="color:#5a9bcf">258.1</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> MB, </span><span class="token number" style="color:#5a9bcf">398.0</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">0.1</span><span class="token plain"> ms  </span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">average mu </span><span class="token operator" style="color:#D0C6F7">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0.125</span><span class="token plain">, current mu </span><span class="token operator" style="color:#D0C6F7">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0.049</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> allocation failure scavenge might not succeed</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token number" style="color:#5a9bcf">6041</span><span class="token plain">:0x5023900</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain">   </span><span class="token number" style="color:#5a9bcf">932940</span><span class="token plain"> ms: Mark-sweep </span><span class="token number" style="color:#5a9bcf">247.5</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token number" style="color:#5a9bcf">258.4</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> -</span><span class="token operator" style="color:#D0C6F7">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">246.4</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token number" style="color:#5a9bcf">258.6</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> MB, </span><span class="token number" style="color:#5a9bcf">293.1</span><span class="token plain"> / </span><span class="token number" style="color:#5a9bcf">0.1</span><span class="token plain"> ms  </span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">average mu </span><span class="token operator" style="color:#D0C6F7">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0.078</span><span class="token plain">, current mu </span><span class="token operator" style="color:#D0C6F7">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0.014</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> allocation failure scavenge might not succeed</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token operator" style="color:#D0C6F7">&lt;</span><span class="token plain">--- JS stacktrace ---</span><span class="token operator" style="color:#D0C6F7">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">: 0xb02d90 node::Abort</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">: 0xa18123 node::FatalError</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">char const*, char const*</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain">: 0xceb85e v8::Utils::ReportOOMFailure</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">v8::internal::Isolate*, char const*, bool</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain">: 0xcebbd7 v8::internal::V8::FatalProcessOutOfMemory</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">v8::internal::Isolate*, char const*, bool</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain">: 0xeb55b5  </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6</span><span class="token plain">: 0xeb60a4  </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">7</span><span class="token plain">: 0xec4517 v8::internal::Heap::CollectGarbage</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">: 0xec78cc v8::internal::Heap::AllocateRawWithRetryOrFailSlowPath</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9</span><span class="token plain">: 0xe8a1ec v8::internal::Factory::NewFillerObject</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">int, bool, v8::internal::AllocationType, v8::internal::AllocationOrigin</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">10</span><span class="token plain">: 0x11f70a6 v8::internal::Runtime_AllocateInYoungGeneration</span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">int, unsigned long*, v8::internal::Isolate*</span><span class="token punctuation" style="color:#D0C6F7">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">11</span><span class="token plain">: 0x15cdf39  </span><span class="token punctuation" style="color:#D0C6F7">[</span><span class="token plain">node</span><span class="token punctuation" style="color:#D0C6F7">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Annnd scratch that. I forgot to take into consideration that I&#x27;m running an EC2 instance on a budget of around $5/month. Believe it or not, that does not buy you enough resources to build a React app. So I do something a bit more manual with this deployment.</p><p>So we return to my local terminal and repeat our build steps:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token function" style="color:#CCEBFF">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token function" style="color:#CCEBFF">git</span><span class="token plain"> pull</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token function" style="color:#CCEBFF">npm</span><span class="token plain"> </span><span class="token function" style="color:#CCEBFF">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token function" style="color:#CCEBFF">npm</span><span class="token plain"> run build</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token comment" style="color:#9598C7"># ... google zip command once again</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token function" style="color:#CCEBFF">zip</span><span class="token plain"> -r build.zip build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And then a quick copy of the build output to the ec2 instance</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token function" style="color:#CCEBFF">scp</span><span class="token plain"> ./build.zip myEC2Instance:/home/ec2-user</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Wonderful. Now, if only I&#x27;d left myself notes on how I&#x27;d configured this service some 6 months ago...</p><p>Rooting through Apache config files I find a <code>&lt;VirtualHost&gt;</code> tag that points me in the right direction. After unzipping my files and copying the build to the directory indicated, I decide to sacrifice my 11 9&#x27;s uptime to figure out how exactly the app is being served.</p><p>First, I kill Apache</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">apachectl -k stop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and visit my site which is down as it should be.</p><p>I restart Apache</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">apachectl -k start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the previous version of the app is still being run. Darn. Upon further inspection it looks like I copied my new build into the previous and the issue is quickly remedied.</p><p>My React site is updated and up and running.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-go-server">Backend (Go Server)<a class="hash-link" href="#backend-go-server" title="Direct link to heading">​</a></h3><p>In my efforts to stay under budget and not get too caught up in infrastructure, I am going to attempt to deploy my Go app to the same instance.</p><p>First, let&#x27;s get the app installed on the instance. The <a href="https://go.dev/dl/" target="_blank" rel="noopener noreferrer">go.dev</a> site has a list of downloads. After finding the appropriate atrifact I was able to run:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token function" style="color:#CCEBFF">wget</span><span class="token plain"> https://go.dev/dl/go1.17.5.linux-amd64.tar.gz  </span><span class="token comment" style="color:#9598C7"># download go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">sha256sum go1.17.5.linux-amd64.tar.gz               </span><span class="token comment" style="color:#9598C7"># verify sha against site</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token function" style="color:#CCEBFF">sudo</span><span class="token plain"> </span><span class="token function" style="color:#CCEBFF">tar</span><span class="token plain"> -C /usr/local go1.17.5.linux-amd64.tar.gz  </span><span class="token comment" style="color:#9598C7"># untar artifact</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token builtin class-name" style="color:#bcc0fb">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#5a9bcf">PATH</span><span class="token operator" style="color:#D0C6F7">=</span><span class="token environment constant" style="color:#5a9bcf">$PATH</span><span class="token plain">:/usr/local/go/bin                 </span><span class="token comment" style="color:#9598C7"># set PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">go version                                          </span><span class="token comment" style="color:#9598C7"># confirm install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For future reference: <a href="https://linuxize.com/post/how-to-install-go-on-centos-7/" target="_blank" rel="noopener noreferrer">linuxize</a></p><p>Next, I clone the <a href="https://github.com/James-D-Wood/personal-site-go-server" target="_blank" rel="noopener noreferrer">go server</a> and run the program:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">go run ./</span><span class="token punctuation" style="color:#D0C6F7">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"></span><span class="token comment" style="color:#9598C7"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">go: downloading github.com/jackc/pgservicefile v0.0.0-20200714003250-2b9c44734f2b</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">go: downloading golang.org/x/crypto v0.0.0-20210711020723-a769d52b0f97</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">go: downloading golang.org/x/text v0.3.6</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">panic: failed to connect to </span><span class="token variable" style="color:#D0C6F7">`</span><span class="token variable assign-left variable" style="color:#D0C6F7">host</span><span class="token variable operator" style="color:#D0C6F7">=</span><span class="token variable" style="color:#D0C6F7">localhost </span><span class="token variable assign-left variable" style="color:#D0C6F7">user</span><span class="token variable operator" style="color:#D0C6F7">=</span><span class="token variable" style="color:#D0C6F7">james </span><span class="token variable assign-left variable" style="color:#D0C6F7">database</span><span class="token variable operator" style="color:#D0C6F7">=</span><span class="token variable" style="color:#D0C6F7">personal_site</span><span class="token variable" style="color:#D0C6F7">`</span><span class="token builtin class-name" style="color:#bcc0fb">:</span><span class="token plain"> dial error </span><span class="token punctuation" style="color:#D0C6F7">(</span><span class="token plain">dial tcp </span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.0.1:5432: connect: connection refused</span><span class="token punctuation" style="color:#D0C6F7">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This reveals two problems:</p><ol><li>Postgres needs to be installed on this instance and</li><li>The app needs to be configured to read for environment vars instead of the hardcoded variables I used in development.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-postgres">Installing Postgres<a class="hash-link" href="#installing-postgres" title="Direct link to heading">​</a></h3><ul><li>Install (not completely clear how I did this)</li><li>Create user for application</li><li>Update <code>pg_hba.conf</code> to permit login</li><li>Create database</li><li>Run scripts to build schema</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="references">References:<a class="hash-link" href="#references" title="Direct link to heading">​</a></h5><ul><li><a href="https://www.postgresql.org/download/linux/redhat/" target="_blank" rel="noopener noreferrer">postgresql downloads</a></li><li><a href="https://unix.stackexchange.com/questions/671851/how-to-deal-with-www-postgres-org-certificate-expired" target="_blank" rel="noopener noreferrer">letsencrypt cert issues</a></li><li><a href="https://techviewleo.com/install-postgresql-13-on-amazon-linux/" target="_blank" rel="noopener noreferrer">amazon specific instructions</a></li><li><a href="https://www.postgresql.org/docs/9.1/auth-pg-hba-conf.html" target="_blank" rel="noopener noreferrer">pg_hba.conf</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-app-for-env">Configuring App for Env<a class="hash-link" href="#configuring-app-for-env" title="Direct link to heading">​</a></h3><p>The next step is to</p><ul><li>API Token</li><li>Postgres Creds</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-apache-for-reverseproxy">Configuring Apache for ReverseProxy<a class="hash-link" href="#configuring-apache-for-reverseproxy" title="Direct link to heading">​</a></h3><p>In order to get requests to my Go app which is running locally on port 8080, I&#x27;ll need to pipe requests through the standard ports 80 (HTTP) and 443 (HTTPS) as these are the only ports I&#x27;ve exposed to the world using my Security Group. I am already serving my client on this server however, so I&#x27;ll need to reconfigure Apache a bit.</p><p>The first thing I needed to figure out was how to serve multiple apps on a single IP-port combination. After some Googling, I came across Name-Based Virtual Hosts. Name-base virtual hosts use the hostname reported by the client to determine routing:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">             GET / HTTP/1.1           EC2 Instance   www.jameswood.dev</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">             Host: *.jameswood.dev       .----.               ------&gt; React App</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    ||&quot;&quot;||   ...                         | == |              |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    ||__||   -------------------------&gt;  |----| ---&gt; Apache -|</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    [ -=.]`)                             |::::|              |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    ====== 0                             |___.|               ------&gt; Golang App</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">                                         &quot;    &quot;      api.jameswood.dev               .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I&#x27;ll take my original virtual host and add a <code>ServerName</code> directive to each to distinguish which host should be used for which hostname. Additionally, I want a <code>ServerAlias</code> directive on the record representing the client so that the www prefix is not required. I also use the <code>ProxyPass</code> and <code>ProxyPassReverse</code> directives as I want to forward the request to my Go Server rather than use Apache as the server as I did in the original VirtualHost.</p><div class="language-apache codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-apache codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">&lt;VirtualHost *:80&gt;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> ServerName &quot;www.jameswood.dev&quot;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> ServerAlias &quot;jameswood.dev&quot;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> DocumentRoot &quot;/var/www/path/to/site&quot;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> ...SSL/redirect directives omitted</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">&lt;/VirtualHost&gt;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">&lt;VirtualHost *:80&gt;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> ServerName &quot;api.jameswood.dev&quot;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> ProxyPass &quot;/&quot;  &quot;http://127.0.0.1:8080/&quot;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> ProxyPassReverse &quot;/&quot;  &quot;http://127.0.0.1:8080/&quot;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain"> ...SSL/redirect directives omitted</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">&lt;/VirtualHost&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After restarting Apache, creating A records for the www and api subdomains, and running certbot to issue SSL certs, my configuration appears to be <strong>almost</strong> running as expected. It turns out a change I made switching from a <code>HashRouter</code> to a <code>BrowserRouter</code> isn&#x27;t playing nice with Apache.</p><p>Before my routes would look something like <code>jameswood.dev/#/notebook</code>. What Apache would see was something like:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">           GET / HTTP/1.1              Apache</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">           Host: jameswood.dev         .----.</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ||&quot;&quot;||   ...                         | == |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ||__||   -------------------------&gt;  |----| ----&gt;  /var/www/index.html ?</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  [ -=.]`) &lt;-------------------------  |::::| &lt;----  👍</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ====== 0            HTTP/1.1 200 OK  |___.|</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">                                       &quot;    &quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And then the <code>HashRouter</code> would work it&#x27;s magic by using the anchor (hash) portion. But I wanted to get rid of that ugly hash so I switched over to <code>BrowserRouter</code> and now the behavior looks a bit more like this:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">           GET /notebook HTTP/1.1      Apache</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">           Host: jameswood.dev         .----.</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ||&quot;&quot;||   ...                         | == |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ||__||   -------------------------&gt;  |----| ----&gt;  /var/www/notebook.html ?</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  [ -=.]`) &lt;-------------------------  |::::| &lt;----  🤬</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ====== 0     HTTP/1.1 404 NOT FOUND  |___.|</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">                                       &quot;    &quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is no good because if I want to direct a user to a particular article or page on my site, the user will always have to go to the homepage first and navigate to it themselves. I want to be able to properly create links to my site so lets reconfigure Apache a bit.</p><div class="language-apache codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-apache codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">&lt;Directory &quot;/var/www/path/to/site&quot;&gt;</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    RewriteEngine on</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    # Don&#x27;t rewrite files or directories</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    RewriteCond %{REQUEST_FILENAME} -f [OR]</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    RewriteCond %{REQUEST_FILENAME} -d</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    RewriteRule ^ - [L]</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    # Rewrite everything else to index.html</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">    RewriteRule ^ index.html [L]</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">&lt;/Directory&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now when I send a request the resource is automatically redirected.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">           GET /notebook HTTP/1.1      Apache</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">           Host: jameswood.dev         .----.</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ||&quot;&quot;||   ...                         | == |</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ||__||   -------------------------&gt;  |----| ----&gt;  /var/www/index.html ?</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  [ -=.]`) &lt;-------------------------  |::::| &lt;----  👍</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">  ====== 0            HTTP/1.1 200 OK  |___.|</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">                                       &quot;    &quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="references-1">References:<a class="hash-link" href="#references-1" title="Direct link to heading">​</a></h5><ul><li><a href="https://httpd.apache.org/docs/2.4/howto/reverse_proxy.html" target="_blank" rel="noopener noreferrer">Apache Docs: Reverse Proxy</a></li><li><a href="https://httpd.apache.org/docs/2.4/vhosts/name-based.html" target="_blank" rel="noopener noreferrer">Apache Docs: Name Based Virtual Hosts</a></li><li><a href="https://httpd.apache.org/docs/2.4/vhosts/examples.html" target="_blank" rel="noopener noreferrer">Apache Docs: VirtualHost Examples</a></li><li><a href="https://httpd.apache.org/docs/2.4/mod/mod_rewrite.html#rewritecond" target="_blank" rel="noopener noreferrer">Apache Docs: Rewrites</a></li><li><a href="https://stackoverflow.com/a/48872476" target="_blank" rel="noopener noreferrer">Stack Overflow Response for Rewrites</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-go-server-as-a-systemd-service">Setting Up Go Server as a Systemd Service<a class="hash-link" href="#setting-up-go-server-as-a-systemd-service" title="Direct link to heading">​</a></h3><p>On Linux systems running Systemd, the <code>/etc/systemd/system/</code> directory contains custom &quot;unit files&quot; that the system admin can manage to create daemons that can be run in the background. I am going to create such a service for our Go App.</p><p>The unit file:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain"># api.service</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">Description=API</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">EnvironmentFile=/home/ec2-user/.personal-site</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">WorkingDirectory=/home/ec2-user</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">ExecStart=. .personal-site \u0026\u0026 cd personal-site-go-server/ \u0026\u0026 go run ./...</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">Restart=always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After that it&#x27;s a matter of running</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#1A1D3B;--prism-color:#dadde1"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#dadde1"><span class="token plain">systemctl start api</span><br></span><span class="token-line" style="color:#dadde1"><span class="token plain">journalctl -u api</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we&#x27;re off!</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="references-2">References:<a class="hash-link" href="#references-2" title="Direct link to heading">​</a></h5><ul><li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-managing_services_with_systemd#sect-Managing_Services_with_systemd-Unit_Files" target="_blank" rel="noopener noreferrer">RedHat Docs: systemd Unit Files</a></li><li><a href="https://www.copperwall.dev/2016-08-04-use-services-for-your-web-apps" target="_blank" rel="noopener noreferrer">Practical Example by Copperwall</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reflection">Reflection<a class="hash-link" href="#reflection" title="Direct link to heading">​</a></h3><p>After this exercise I now have</p><ul><li>an EC2 instance with</li><li>a Apache server running serving</li><li>jameswood.dev with a React Client and</li><li>proxying requests to api.jameswood.dev to a systemd service running my Go app, backed by</li><li>a PostgreSQL service (that is not external exposed)</li></ul><p>All for $5/month. Pretty nifty! So here are some of the drawbacks:</p><ul><li>This instance is <strong>completely</strong> self managed, meaning I have to be on top of manually monitoring and maintenancing not only my site but the instance it runs on.</li><li>Pushing updates is a pain. There is no automation which means about 30 minutes of work <em>if</em> I remember what I&#x27;m doing.</li><li>The instance is not in any way highly available. There is no replication, no distribution between data centers, no failover, no backups. If this VM crashes or gets reclaimed I am back to square one. (There are ways to mitigate this and that is to come.)</li><li>The instance does not have enough compute to handle Docker, meaning I can&#x27;t practice this technology in this set up.</li></ul><p>But, all that being said, this is a relatively cheap way to run a production environment to experiment in, especially when I&#x27;m expected little to no traffic. Also, it gives me great Linux admin practice that I wouldn&#x27;t normally get in a more Cloud Native environment.</p><p>Going forward I want to:</p><ul class="contains-task-list containsTaskList_mC6p"><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Create an image of my VM so that it is easy to recreate on failure.</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Automate backups of my database.</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/personal-site/features/value_sort"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Value Sort</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/home-lab"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Home Lab</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#may-4-2024" class="table-of-contents__link toc-highlight">May 4, 2024</a><ul><li><a href="#creating-the-meta-endpoint" class="table-of-contents__link toc-highlight">Creating the /meta endpoint</a></li></ul></li><li><a href="#december-13-2021" class="table-of-contents__link toc-highlight">December 13, 2021</a><ul><li><a href="#setting-up-the-site" class="table-of-contents__link toc-highlight">Setting up the Site</a></li><li><a href="#system-outline" class="table-of-contents__link toc-highlight">System Outline</a></li><li><a href="#front-end-react-client" class="table-of-contents__link toc-highlight">Front End (React Client)</a></li><li><a href="#backend-go-server" class="table-of-contents__link toc-highlight">Backend (Go Server)</a></li><li><a href="#installing-postgres" class="table-of-contents__link toc-highlight">Installing Postgres</a></li><li><a href="#configuring-app-for-env" class="table-of-contents__link toc-highlight">Configuring App for Env</a></li><li><a href="#configuring-apache-for-reverseproxy" class="table-of-contents__link toc-highlight">Configuring Apache for ReverseProxy</a></li><li><a href="#setting-up-go-server-as-a-systemd-service" class="table-of-contents__link toc-highlight">Setting Up Go Server as a Systemd Service</a></li><li><a href="#reflection" class="table-of-contents__link toc-highlight">Reflection</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d96171f6.js"></script>
<script src="/assets/js/main.2354cdf8.js"></script>
</body>
</html>